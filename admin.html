<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin â€“ Velozza Events</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: #fff;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    h1 {
      margin-top: 40px;
      text-transform: uppercase;
      letter-spacing: 2px;
    }

    .login-box, .admin-panel {
      margin-top: 40px;
      background: #1c1c1c;
      padding: 30px;
      border-radius: 8px;
      width: 90%;
      max-width: 400px;
      box-shadow: 0 0 10px rgba(255,255,255,0.1);
    }

    input, button, select {
      width: 100%;
      padding: 12px;
      margin-top: 12px;
      font-size: 16px;
      border-radius: 6px;
      border: none;
    }

    input {
      background: #2a2a2a;
      color: white;
    }

    button {
      background: #e53935;
      color: white;
      cursor: pointer;
      transition: 0.2s;
    }
    button:hover {
      background: #ff4b47;
    }

    .hidden { display: none; }
    .success {
      color: #66ff99;
      margin-top: 10px;
    }
    .error {
      color: #ff6666;
      margin-top: 10px;
    }
  </style>
</head>

<body>
  <h1>Admin Panel</h1>

  <!-- LOGIN -->
  <div id="loginBox" class="login-box">
    <h2>Login</h2>
    <input type="password" id="passwordInput" placeholder="Enter admin password" />
    <button id="loginBtn">Login</button>
    <p id="loginError" class="error"></p>
  </div>

  <!-- ADMIN PANEL -->
  <div id="adminPanel" class="admin-panel hidden">
    <h2>Add Event</h2>

    <input type="date" id="eventDate" />
    <input type="text" id="eventName" placeholder="Event name" />
    <input type="text" id="eventLocation" placeholder="Location" />
    <input type="text" id="eventCity" placeholder="City" />
    <input type="text" id="eventCountry" placeholder="Country" />
    <input type="text" id="eventTime" placeholder="Time (optional)" />
    <input type="text" id="eventLink" placeholder="Ticket link (optional)" />

    <button id="saveEvent">Save Event</button>
    <p id="saveMsg" class="success"></p>
  </div>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    // ---------------------------
    // ðŸ”¥ YOUR FIREBASE CONFIG
    // ---------------------------
    const firebaseConfig = {
      apiKey: "AIzaSyAj7nzvflTuXerUQ9LzOnn7TRojw4ZHlkc",
      authDomain: "velozza-events.firebaseapp.com",
      projectId: "velozza-events",
      storageBucket: "velozza-events.firebasestorage.app",
      messagingSenderId: "125892769650",
      appId: "1:125892769650:web:81deb40d2b0a7e7bb58feb",
      measurementId: "G-HS8GCH4040"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // ---------------------------
    // ðŸ” PASSWORD SECURITY
    // ---------------------------

    // Correct SHA-256 hash for:  R7pX92fGq4mT8bLd
    // const ADMIN_HASH = "ff71c7b458fafa4cb1cca103fe278b42cd9e6b6e4fbde3ca8a076cc473895f96";

    // async function sha256(message) {
    //   const encoder = new TextEncoder();
    //   const data = encoder.encode(message.trim());
    //   const hashBuffer = await crypto.subtle.digest("SHA-256", data);
    //   return [...new Uint8Array(hashBuffer)]
    //     .map(b => b.toString(16).padStart(2, "0"))
    //     .join("");
    // }

    document.getElementById("loginBtn").onclick = async () => {
      const pwd = document.getElementById("passwordInput").value.trim();
      // const hashed = await sha256(pwd);
      // if (hashed === ADMIN_HASH) {
      if (pwd === "R7pX92fGq4mT8bLd") {
        document.getElementById("loginBox").classList.add("hidden");
        document.getElementById("adminPanel").classList.remove("hidden");
      } else {
        document.getElementById("loginError").textContent = "Incorrect password.";
      }


    };

    // ---------------------------
    // ðŸ“Œ SAVE EVENT TO FIRESTORE
    // ---------------------------
    document.getElementById("saveEvent").onclick = async () => {
      const date = document.getElementById("eventDate").value;
      const name = document.getElementById("eventName").value.trim();
      const location = document.getElementById("eventLocation").value.trim();
      const city = document.getElementById("eventCity").value.trim();
      const country = document.getElementById("eventCountry").value.trim();      
      const time = document.getElementById("eventTime").value.trim();
      const link = document.getElementById("eventLink").value.trim();

      if (!date || !name || !location) {
        document.getElementById("saveMsg").textContent = "Missing required fields.";
        return;
      }

      await addDoc(collection(db, "events"), {
        date,
        name,
        location,
        city,
        country,
        time,
        link,
        createdAt: Date.now()
      });

      document.getElementById("saveMsg").textContent = "Event saved!";
      document.getElementById("eventDate").value = "";
      document.getElementById("eventName").value = "";
      document.getElementById("eventLocation").value = "";
      document.getElementById("eventCity").value = "";
      document.getElementById("eventCountry").value = "";
      document.getElementById("eventTime").value = "";
      document.getElementById("eventLink").value = "";
    };
  </script>
</body>
</html>
